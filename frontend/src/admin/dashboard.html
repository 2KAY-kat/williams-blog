<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Williams Blog | Dashboard</title>
  <link rel="stylesheet" href="../css/dashboard.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
  TinyMCE Rich Text Editor
<!-- <script src="https://cdn.tiny.cloud/1/rvp29clgszn9113xmtcln0hf0cx1bzl5m51chhoctrtsvwql/tinymce/6/tinymce.min.js"></script> -->

</head>
<body class="dashboard-page" id="dashboard">
  <div class="dashboard-container">
    <!-- Loading Spinner -->
    <div id="loading-spinner" class="loading-spinner">
      <div class="spinner-content">
        <div class="spinner"></div>
        <p class="spinner-text">Loading...</p>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal-overlay hidden">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-icon-wrapper">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <h2>Delete Post?</h2>
        </div>

        <div class="modal-body">
          <p>Are you sure you want to delete this post?</p>
          <div class="delete-warning">
            <i class="fas fa-info-circle"></i>
            <span>This action cannot be undone. The post will be permanently removed from your blog.</span>
          </div>
          <div class="post-preview">
            <p class="preview-title" id="delete-post-title">Post Title</p>
            <p class="preview-date" id="delete-post-date">Created on Jan 1, 2024</p>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="modal-btn modal-btn-cancel" id="delete-cancel-btn">
            <i class="fas fa-times"></i> Cancel
          </button>
          <button type="button" class="modal-btn modal-btn-delete" id="delete-confirm-btn">
            <i class="fas fa-trash"></i> <span>Delete Post</span>
          </button>
        </div>
      </div>
    </div>

    <!-- SIDEBAR -->
    <aside class="sidebar">
      
      <nav class="nav">
        <a href="#" class="nav-link" data-view="home" data-label="Home"><i class="fas fa-home"></i> <span>Home</span></a>
        <a href="#" class="nav-link" data-view="posts" data-label="Posts"><i class="fas fa-file-alt"></i> <span>Posts</span></a>
        <a href="#" class="nav-link" data-view="write" data-label="Write"><i class="fas fa-pen-fancy"></i> <span>Write</span></a>
        <a href="#" class="nav-link" data-view="profile" data-label="Profile"><i class="fas fa-user"></i> <span>Profile</span></a>
        <a href="#" class="nav-link" data-view="subscribers" data-label="Subscribers"><i class="fas fa-bell"></i> <span>Subscribers</span></a>
        <a href="#" id="logout-btn" class="nav-link" data-label="Logout"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a>
      </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
            <header class="header">
        <div class="header-left">
          <a href="../../index.html" class="back-to-blog-btn" title="Back to Blog">
            <i class="fas fa-arrow-left"></i>
            <span>Back to Blog</span>
          </a>
          <h1 id="page-title">Home</h1>
        </div>
        <button id="add-post-btn" class="cta-link subscribe-btn">+ New Post</button>
      </header>

      <div class="viwes-dash">

        <section id="home-view" class="view">
          <div class="onboarding-container">
            <div class="onboarding-header">
              <h2>Welcome back, <span id="blogger-name">Blogger</span>! ðŸ‘‹</h2>
              <p class="onboarding-subtitle">Let's make your blog amazing</p>
            </div>

            <div class="onboarding-grid">
              <!-- Write Post Card -->
              <div class="onboarding-card">
                <div class="card-icon write-icon">
                  <i class="fas fa-pen-fancy"></i>
                </div>
                <h3>Create Your First Post</h3>
                <p>Share your thoughts, ideas, and expertise with your audience</p>
                <button class="onboarding-btn" data-action="write">
                  Start Writing
                  <i class="fas fa-arrow-right"></i>
                </button>
              </div>

              <!-- View Posts Card -->
              <div class="onboarding-card">
                <div class="card-icon posts-icon">
                  <i class="fas fa-file-alt"></i>
                </div>
                <h3>Manage Your Posts</h3>
                <p>Edit, publish, or delete your posts and track their performance</p>
                <button class="onboarding-btn" data-action="posts">
                  View Posts
                  <i class="fas fa-arrow-right"></i>
                </button>
              </div>

              <!-- Profile Card -->
              <div class="onboarding-card">
                <div class="card-icon profile-icon">
                  <i class="fas fa-user-circle"></i>
                </div>
                <h3>Complete Your Profile</h3>
                <p>Update your information to personalize your blogging experience</p>
                <button class="onboarding-btn" data-action="profile">
                  Edit Profile
                  <i class="fas fa-arrow-right"></i>
                </button>
              </div>

              <!-- Subscribers Card -->
              <div class="onboarding-card">
                <div class="card-icon subscribers-icon">
                  <i class="fas fa-bell"></i>
                </div>
                <h3>Connect with Subscribers</h3>
                <p>Engage with your audience and build a loyal community</p>
                <button class="onboarding-btn" data-action="subscribers">
                  View Subscribers
                  <i class="fas fa-arrow-right"></i>
                </button>
              </div>
            </div>

            <div class="onboarding-stats">
              <div class="stat-item">
                <div class="stat-number" id="stat-posts">0</div>
                <div class="stat-label">Total Posts</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="stat-subscribers">0</div>
                <div class="stat-label">Subscribers</div>
              </div>
              <div class="stat-item">
                <div class="stat-number" id="stat-published">0</div>
                <div class="stat-label">Published</div>
              </div>
            </div>

            <div class="onboarding-footer">
              <p>Need help? Check our <a href="#" class="help-link">documentation</a></p>
            </div>
          </div>
        </section>

        <section id="posts-view" class="view">
          <div class="posts-grid" id="posts-container">
          </div>
        </section>

        <section id="write-view" class="view">
          <div class="write-container">
            <div class="write-header">
              <div>
                <h2 id="write-title">New Post</h2>
                <p class="write-subtitle" id="write-subtitle">Share your thoughts with the world</p>
              </div>
              <button type="button" class="btn-close-write" id="close-write-btn" title="Close">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <form id="post-form" class="write-form">
              <input type="hidden" name="postid" />
              
              <div class="write-main">
                <div class="form-section">
                  <input type="text" name="title" placeholder="Post Title" class="write-title-input" required />
                  <textarea id="post-content-editor" name="content" placeholder="Write your post content here..." class="write-content-input" required></textarea>
                </div>

                <div class="write-sidebar">
                  <div class="form-section">
                    <h3>Publish Settings</h3>
                    <label class="checkbox-group">
                      <input type="checkbox" name="ispublished" />
                      <span>Publish immediately</span>
                    </label>
                  </div>

                  <div class="form-section">
                    <h3>Featured Image</h3>
                    <div class="image-upload">
                      <input type="hidden" name="main_image_url" id="current-image-url" />
                      <input type="file" name="image_file" id="image-file-input" accept="image/*" />
                      <label for="image-file-input" class="file-label">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>Click to upload</span>
                      </label>
                      <p id="image-preview-text" class="image-preview-text"></p>
                    </div>
                  </div>

                  <div class="form-section">
                    <h3>Categories</h3>
                    <div id="categories-checkboxes" class="categories-list"></div>
                  </div>

                  <div class="form-actions">
                    <button type="button" class="btn-secondary" id="cancel-post-btn">Cancel</button>
                    <button type="submit" class="btn-primary">
                      <span class="btn-text">Save Post</span>
                      <span class="btn-spinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </section>

        <section id="profile-view" class="view">
          <div class="profile-container">
            <!-- Profile Header -->
            <div class="profile-header">
              <div class="profile-cover"></div>
              <div class="profile-info">
                <div class="profile-avatar">
                  <!-- <img id="profile-avatar-img" src="https://via.placeholder.com/120" alt="Profile">
                  <button id="avatar-upload-btn" class="avatar-upload-btn" type="button">
                    <i class="fas fa-camera"></i>
                  </button>
                  <input type="file" id="avatar-file-input" accept="image/*" style="display: none;"> -->
                </div>
                <div class="profile-details">
                  <h2 id="profile-display-name">Blogger Name</h2>
                  <p id="profile-display-email">email@example.com</p>
                </div>
              </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="profile-tabs">
              <button class="profile-tab-btn active" data-tab="account">
                <i class="fas fa-user"></i> Account
              </button>
              <button class="profile-tab-btn" data-tab="security">
                <i class="fas fa-lock"></i> Security
              </button>
              <button class="profile-tab-btn" data-tab="preferences">
                <i class="fas fa-cog"></i> Preferences
              </button>
            </div>

            <!-- Account Tab -->
            <div class="profile-tab-content active" id="account-tab">
              <div class="profile-card">
                <div class="card-header">
                  <h3>Account Information</h3>
                  <p>Manage your basic profile information</p>
                </div>

                <form id="account-form" class="profile-form">
                  <div class="form-row">
                    <div class="form-group">
                      <label for="profile-full-name">Full Name</label>
                      <input type="text" id="profile-full-name" name="full_name" placeholder="Your full name" required>
                      <small class="form-help">This is how your name appears on your blog</small>
                    </div>
                    <div class="form-group">
                      <label for="profile-username">Username</label>
                      <input type="text" id="profile-username" name="username" placeholder="Your username" required>
                      <small class="form-help">Used in your blog URL</small>
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="profile-email">Email Address</label>
                      <input type="email" id="profile-email" name="email" placeholder="your@email.com" required>
                      <small class="form-help">We'll use this for important notifications</small>
                    </div>
                    <div class="form-group">
                      <label for="profile-phone">Phone Number (Optional)</label>
                      <input type="tel" id="profile-phone" name="phone" placeholder="+1 (555) 000-0000">
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="profile-bio">Bio</label>
                    <textarea id="profile-bio" name="bio" placeholder="Tell readers a bit about yourself" rows="4" maxlength="500"></textarea>
                    <small class="form-help"><span id="bio-char-count">0</span>/500 characters</small>
                  </div>

                  <div class="form-group">
                    <label for="profile-website">Website (Optional)</label>
                    <input type="url" id="profile-website" name="website" placeholder="https://yourwebsite.com">
                  </div>

                  <div class="form-actions">
                    <button type="submit" class="btn-primary">
                      <i class="fas fa-save"></i> Save Changes
                    </button>
                    <button type="button" class="btn-secondary" id="reset-account-btn">
                      <i class="fas fa-undo"></i> Cancel
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Security Tab -->
            <div class="profile-tab-content" id="security-tab">
              <div class="profile-card">
                <div class="card-header">
                  <h3>Security Settings</h3>
                  <p>Keep your account safe and secure</p>
                </div>

                <!-- Change Password -->
                <div class="security-section">
                  <div class="security-header">
                    <div>
                      <h4>Change Password</h4>
                      <p>Update your password regularly to keep your account secure</p>
                    </div>
                    <button type="button" class="btn-secondary-small" id="toggle-password-form">Change Password</button>
                  </div>

                  <form id="password-form" class="security-form hidden">
                    <div class="form-group">
                      <label for="current-password">Current Password</label>
                      <div class="password-input-group">
                        <input type="password" id="current-password" name="current_password" placeholder="Enter your current password" required>
                        <button type="button" class="password-toggle" data-target="current-password">
                          <i class="fas fa-eye"></i>
                        </button>
                      </div>
                    </div>

                    <div class="form-group">
                      <label for="new-password">New Password</label>
                      <div class="password-input-group">
                        <input type="password" id="new-password" name="new_password" placeholder="Enter a new password" required>
                        <button type="button" class="password-toggle" data-target="new-password">
                          <i class="fas fa-eye"></i>
                        </button>
                      </div>
                      <small class="form-help">At least 8 characters with uppercase, lowercase, and numbers</small>
                    </div>

                    <div class="form-group">
                      <label for="confirm-password">Confirm New Password</label>
                      <div class="password-input-group">
                        <input type="password" id="confirm-password" name="confirm_password" placeholder="Confirm your new password" required>
                        <button type="button" class="password-toggle" data-target="confirm-password">
                          <i class="fas fa-eye"></i>
                        </button>
                      </div>
                    </div>

                    <div class="password-strength">
                      <div class="strength-bar">
                        <div class="strength-indicator" id="strength-indicator"></div>
                      </div>
                      <p class="strength-text" id="strength-text">Password strength: Weak</p>
                    </div>

                    <div class="form-actions">
                      <button type="submit" class="btn-primary">
                        <i class="fas fa-lock"></i> Update Password
                      </button>
                      <button type="button" class="btn-secondary" id="cancel-password-btn">Cancel</button>
                    </div>
                  </form>
                </div>

                <!-- Two-Factor Authentication -->
                <div class="security-section">
                  <div class="security-header">
                    <div>
                      <h4>Two-Factor Authentication</h4>
                      <p>Add an extra layer of security to your account</p>
                    </div>
                    <button type="button" class="btn-secondary-small" id="enable-2fa-btn">Enable 2FA</button>
                  </div>
                  <p class="status-text" id="2fa-status">Status: <span class="badge-inactive">Not Enabled</span></p>
                </div>

                <!-- Active Sessions -->
                <div class="security-section">
                  <h4>Active Sessions</h4>
                  <p class="subtitle">Devices where you're currently logged in</p>
                  <div class="sessions-list">
                    <div class="session-item">
                      <div class="session-info">
                        <div class="session-device">
                          <i class="fas fa-laptop"></i>
                          <div>
                            <p class="device-name">This Device</p>
                            <small>Last active: just now</small>
                          </div>
                        </div>
                      </div>
                      <span class="badge-active">Current</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Preferences Tab -->
            <div class="profile-tab-content" id="preferences-tab">
              <div class="profile-card">
                <div class="card-header">
                  <h3>Preferences</h3>
                  <p>Customize your blogging experience</p>
                </div>

                <form id="preferences-form" class="profile-form">
                  <div class="form-group">
                    <label>Email Notifications</label>
                    <div class="toggle-group">
                      <div class="toggle-item">
                        <div class="toggle-label">
                          <p>New comments on your posts</p>
                          <small>Get notified when someone comments</small>
                        </div>
                        <input type="checkbox" id="notify-comments" class="toggle-checkbox" checked>
                        <label for="notify-comments" class="toggle-switch"></label>
                      </div>

                      <div class="toggle-item">
                        <div class="toggle-label">
                          <p>New subscribers</p>
                          <small>Get notified when someone subscribes</small>
                        </div>
                        <input type="checkbox" id="notify-subscribers" class="toggle-checkbox" checked>
                        <label for="notify-subscribers" class="toggle-switch"></label>
                      </div>

                      <div class="toggle-item">
                        <div class="toggle-label">
                          <p>Weekly digest</p>
                          <small>Receive a weekly summary of your blog stats</small>
                        </div>
                        <input type="checkbox" id="notify-weekly" class="toggle-checkbox">
                        <label for="notify-weekly" class="toggle-switch"></label>
                      </div>
                    </div>
                  </div>

                  <div class="form-group">
                    <label>Privacy Settings</label>
                    <div class="toggle-group">
                      <div class="toggle-item">
                        <div class="toggle-label">
                          <p>Public profile</p>
                          <small>Allow others to view your profile</small>
                        </div>
                        <input type="checkbox" id="public-profile" class="toggle-checkbox" checked>
                        <label for="public-profile" class="toggle-switch"></label>
                      </div>

                      <div class="toggle-item">
                        <div class="toggle-label">
                          <p>Show email address</p>
                          <small>Display your email publicly</small>
                        </div>
                        <input type="checkbox" id="show-email" class="toggle-checkbox">
                        <label for="show-email" class="toggle-switch"></label>
                      </div>
                    </div>
                  </div>

                  <div class="form-actions">
                    <button type="submit" class="btn-primary">
                      <i class="fas fa-save"></i> Save Preferences
                    </button>
                  </div>
                </form>
              </div>

              <!-- Danger Zone -->
              <div class="profile-card danger-zone">
                <div class="card-header">
                  <h3>Danger Zone</h3>
                  <p>Irreversible actions</p>
                </div>

                <div class="danger-action">
                  <div>
                    <h4>Delete Your Account</h4>
                    <p>Permanently delete your account and all associated data</p>
                  </div>
                  <button type="button" class="btn-danger" id="delete-account-btn">
                    <i class="fas fa-trash"></i> Delete Account
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section> 
      </div>
    </main>
  </div>

  <script type="module" src="../js/auth-check.js"></script>
  <script type="module" src="../js/dashboard.js"></script>
</body>
</html>


<!-- 

import { showToast } from './toast.js';
import { BASE_API_URL } from './utils.js';

const token = localStorage.getItem('auth_token');
if (!token) {
    window.location.href = '../auth/signup.html';
}

let bloggerId = null;
let currentEditingPost = null;

let postToDelete = null;


function showLoadingSpinner() {
    const spinner = document.getElementById('loading-spinner');
    if (spinner) {
        spinner.classList.remove('hidden');
    }
}

function hideLoadingSpinner() {
    const spinner = document.getElementById('loading-spinner');
    if (spinner) {
        spinner.classList.add('hidden');
    }
}


// ============================================================
// TinyMCE Rich Text Editor Initialization
// ============================================================

function initializeTinyMCE() {
    // Check if TinyMCE is already initialized for this textarea
    if (tinymce.get('post-content-editor')) {
        tinymce.get('post-content-editor').remove();
    }

    tinymce.init({
        selector: '#post-content-editor',
        plugins: [
            'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
            'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen', 'insertdatetime',
            'media', 'table', 'help', 'wordcount'
        ],
        toolbar: 'undo redo | formatselect | bold italic underline strikethrough | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | code | removeformat | help',
        menu: {
            favs: {
                title: 'My Favorites',
                items: 'bold italic underline | strikethrough | forecolor backcolor'
            }
        },
        menubar: 'favs file edit view insert format tools table help',
        height: 400,
        branding: false,
        statusbar: true,
        content_css: [
            'https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap'
        ],
        style_formats: [
            { title: 'Heading 2', format: 'h2' },
            { title: 'Heading 3', format: 'h3' },
            { title: 'Heading 4', format: 'h4' },
            { title: 'Paragraph', format: 'p' },
        ],
        content_style: `
            body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
            h2 { font-size: 1.9rem; font-weight: 700; margin: 1.5em 0 0.5em 0; }
            h3 { font-size: 1.4rem; font-weight: 700; margin: 1.2em 0 0.4em 0; }
            h4 { font-size: 1.1rem; font-weight: 700; margin: 1em 0 0.3em 0; }
            p { margin: 0 0 1em 0; line-height: 1.8; }
            blockquote { border-left: 5px solid #bf092f; background: rgba(191, 9, 47, 0.04); padding: 1.5em 2em; margin: 1.5em 0; }
            code { background: #f5f7fa; color: #bf092f; padding: 2px 6px; border-radius: 4px; }
            pre { background: #1e293b; color: #e2e8f0; padding: 1.5em; border-radius: 8px; }
            a { color: #132440; text-decoration: underline; }
            ul, ol { margin: 1em 0; padding-left: 2em; }
            li { margin-bottom: 0.5em; }
            img { max-width: 100%; height: auto; border-radius: 8px; }
        `,
        setup: function(editor) {
            editor.on('init', function() {
                console.log('TinyMCE editor initialized');
            });
        }
    });
}

function destroyTinyMCE() {
    if (tinymce.get('post-content-editor')) {
        tinymce.get('post-content-editor').remove();
    }
}


try {
    const payload = JSON.parse(atob(token.split('.')[1]));
    bloggerId = payload.data.id;
} catch (e) {
    console.error("Invalid token format:", e);
    localStorage.removeItem('auth_token');
    window.location.href = '../auth/signup.html';
}

// State Management
const DASHBOARD_STATE_KEY = 'dashboard_active_view';

function saveActiveView(viewName) {
    try {
        localStorage.setItem(DASHBOARD_STATE_KEY, viewName);
    } catch (err) {
        console.warn('Failed to save active view:', err);
    }
}

function getActiveView() {
    try {
        const saved = localStorage.getItem(DASHBOARD_STATE_KEY);
        return saved || 'home'; // Default to 'home' if not found
    } catch (err) {
        console.warn('Failed to retrieve active view:', err);
        return 'home';
    }
}

function switchView(viewName, navLinks) {
    const views = document.querySelectorAll('.view');
    const targetView = document.getElementById(`${viewName}-view`);
    
    if (!targetView) {
        console.error(`View ${viewName}-view not found`);
        return;
    }
    
    // Hide all views
    views.forEach(v => {
        v.classList.remove('active');
    });
    
    // Show selected view
    targetView.classList.add('active');
    
    // Update active nav link
    navLinks.forEach(link => {
        if (link.dataset.view === viewName) {
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }
    });
    
    // Update page title
    let viewTitle = 'Home';
    if (viewName === 'posts') viewTitle = 'My Posts';
    else if (viewName === 'write') viewTitle = 'Write';
    else if (viewName === 'profile') viewTitle = 'Profile';
    else if (viewName === 'subscribers') viewTitle = 'Subscribers';
    document.getElementById('page-title').textContent = viewTitle;
    
    // Save state
    saveActiveView(viewName);
    
    // Load data based on view
    if (viewName === 'posts') {
        loadPosts();
    } else if (viewName === 'profile') {
        loadProfile();
    } else if (viewName === 'write') {
    initializeWriteView(currentEditingPost);
    currentEditingPost = null;
} else {
    destroyTinyMCE();
}
}

document.addEventListener('DOMContentLoaded', () => {
 // Hide spinner after page loads
    hideLoadingSpinner();
    
    const navLinks = document.querySelectorAll('.nav-link');
    const postForm = document.getElementById('post-form');
    const addPostBtn = document.getElementById('add-post-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const closeWriteBtn = document.getElementById('close-write-btn');
    const cancelPostBtn = document.getElementById('cancel-post-btn');


    // Navigation
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            if (link.id === 'logout-btn') return;
            e.preventDefault();
            
            const view = link.dataset.view;
            switchView(view, navLinks);
        });
    });

    // Add Post Button
    addPostBtn.addEventListener('click', () => {
        switchView('write', navLinks);
    });

    // Close Write View
    closeWriteBtn.addEventListener('click', () => {
        switchView('posts', navLinks);
    });

    cancelPostBtn.addEventListener('click', () => {
        switchView('posts', navLinks);
    });

    // Forms
    postForm.addEventListener('submit', handlePostSubmit);

    // Event delegation for post actions (edit/delete)
    document.addEventListener('click', (e) => {
        // Handle edit button clicks
        if (e.target.closest('.btn-edit')) {
            e.preventDefault();
            const postCard = e.target.closest('.post-card');
            const postIdAttr = postCard?.dataset.postId;
            
            if (postIdAttr) {
                editPost(parseInt(postIdAttr));
            }
        }
        
        // Handle delete button clicks
        if (e.target.closest('.btn-delete')) {
            e.preventDefault();
            const postCard = e.target.closest('.post-card');
            const postIdAttr = postCard?.dataset.postId;
            
            if (postIdAttr) {
                deletePost(parseInt(postIdAttr));
            }
        }
    });
    
    // Logout
    logoutBtn.addEventListener('click', (e) => {
        e.preventDefault();
        localStorage.removeItem('auth_token');
        localStorage.removeItem(DASHBOARD_STATE_KEY);
        showToast('Logged out successfully.', 'success');
        setTimeout(() => window.location.href = '../auth/signup.html', 1000);
    });

    // Initial load
    loadCategories();
    
    loadBloggerGreeting();
    
    // Load dashboard stats
    loadDashboardStats();
    
    // Onboarding card button handlers
    document.querySelectorAll('.onboarding-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const action = btn.dataset.action;
            switchView(action, navLinks);
        });
    });
    // Restore previous active view or default to home
    const savedView = getActiveView();
    switchView(savedView, navLinks);

    // Delete modal handlers
    const deleteModal = document.getElementById('delete-modal');
    const deleteCancelBtn = document.getElementById('delete-cancel-btn');
    const deleteConfirmBtn = document.getElementById('delete-confirm-btn');

    if (deleteCancelBtn) {
        deleteCancelBtn.addEventListener('click', hideDeleteModal);
    }

    if (deleteModal) {
        deleteModal.addEventListener('click', (e) => {
            if (e.target === deleteModal) {
                hideDeleteModal();
            }
        });
    }

    if (deleteConfirmBtn) {
        deleteConfirmBtn.addEventListener('click', async () => {
            if (!postToDelete) return;

            const originalHTML = deleteConfirmBtn.innerHTML;
            deleteConfirmBtn.disabled = true;
            deleteConfirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            try {
                const res = await fetch(`${BASE_API_URL}/posts/${postToDelete}`, {
                    method: 'DELETE',
                    headers: { Authorization: `Bearer ${token}` }
                });

                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.error || 'Delete failed');
                }

                showToast('Post deleted successfully!', 'success');
                hideDeleteModal();
                loadPosts(); // Reload posts list
            } catch (err) {
                console.error('Error deleting post:', err);
                showToast(`Error: ${err.message}`, 'error');
            } finally {
                deleteConfirmBtn.disabled = false;
                deleteConfirmBtn.innerHTML = originalHTML;
            }
        });
    }

    // Event delegation for delete buttons (if using the previous setup)
    document.addEventListener('click', (e) => {
        if (e.target.closest('.btn-delete')) {
            e.preventDefault();
            const postCard = e.target.closest('.post-card');
            const postIdAttr = postCard?.dataset.postId;
            
            if (postIdAttr) {
                deletePost(parseInt(postIdAttr));
            }
        }
    });
});

function initializeWriteView(post = null) {
    const form = document.getElementById('post-form');
    const writeTitle = document.getElementById('write-title');
    const writeSubtitle = document.getElementById('write-subtitle');
    
    // Reset form
    form.reset();
    form.postid.value = '';
    document.querySelector('.btn-text').textContent = 'Save Post';

    if (post) {
        writeTitle.textContent = 'Edit Post';
        writeSubtitle.textContent = 'Update your post';
        form.title.value = post.title || '';
        form.content.value = post.content || '';
        form.ispublished.checked = post.ispublished === 1 || post.ispublished === true;
        form.postid.value = post.postid;

        const imageUrl = post.main_image_url;
        if (imageUrl) {
            document.getElementById('current-image-url').value = imageUrl;
            document.getElementById('image-preview-text').textContent = `Current: ${imageUrl.split('/').pop()}`;
            document.getElementById('image-preview-text').style.display = 'block';
        }
    } else {
        writeTitle.textContent = 'New Post';
        writeSubtitle.textContent = 'Share your thoughts with the world';
        document.getElementById('image-preview-text').style.display = 'none';
    }

    // Categories
    const container = document.getElementById('categories-checkboxes');
    const postCategoryNames = post?.categories || [];

    container.innerHTML = allCategories.map(cat => {
        const isChecked = postCategoryNames.includes(cat.name);
        return `
            <label>
                <input type="checkbox" class="category-checkbox" name="categories" value="${cat.category_id}" 
                ${isChecked ? 'checked' : ''}>
                ${cat.name}
            </label>
        `;
    }).join('');

    // Initialize TinyMCE after DOM is ready
    setTimeout(() => {
        initializeTinyMCE();
        // Set content after TinyMCE is initialized
        if (post && tinymce.get('post-content-editor')) {
            tinymce.get('post-content-editor').setContent(post.content || '');
        }
    }, 100);
} 

async function loadPosts() {
    showLoadingSpinner();
    const list = document.getElementById('posts-container');
    
    try {
        const res = await fetch(`${BASE_API_URL}/posts?blogger_id=${bloggerId}`, {
            headers: { Authorization: `Bearer ${token}` }
        });
        
        if (!res.ok) {
            const errorData = await res.json();
            throw new Error(errorData.error || 'Failed to load posts');
        }
        
        const posts = await res.json();
        
        if (!Array.isArray(posts)) {
            throw new Error('Invalid posts data');
        }

        // Clear loading message
        list.innerHTML = '';
        
        if (posts.length === 0) {
            list.innerHTML = '<p style="padding: 2rem; text-align: center; grid-column: 1/-1;">No posts yet. <a href="#" onclick="document.getElementById(\'add-post-btn\').click(); return false;" style="color: var(--accent-color); text-decoration: none; font-weight: 600;">Create your first post</a></p>';
            hideLoadingSpinner();
            return;
        }

        const postsHTML = posts.map(post => `
            <div class="post-card" data-post-id="${post.postid}">
                <div class="post-card-header">
                    <h4 class="posts-heading-prev">${post.title}</h4>
                </div>
                <div class="post-card-body">
                    <p class="posts-content-prev">${post.content_preview || post.content}</p>
                </div>
                <div class="post-card-footer">
                    <div class="details-meta">
                        <small><i class="fas fa-calendar"></i> ${new Date(post.created_at).toLocaleDateString()}</small>
                        <span class="status ${post.ispublished ? 'published' : 'draft'}">
                            <i class="fas"></i> ${post.ispublished ? 'Published' : 'Draft'}
                        </span>
                    </div>
                    <div class="actions">
                        <button class="btn-edit" type="button" title="Edit post">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn-delete" type="button" title="Delete post">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
        
        list.innerHTML = postsHTML;
    } catch (err) {
        console.error('Error loading posts:', err);
        list.innerHTML = `<p style="padding: 2rem; text-align: center; grid-column: 1/-1; color: #d32f2f;">Error loading posts: ${err.message}</p>`;
    } finally {
        hideLoadingSpinner();
    }
}


let allCategories = [];
async function loadCategories() {
    try {
        const res = await fetch(`${BASE_API_URL}/categories`);

        if (!res.ok) throw new Error(`Failed to fetch categories: ${res.status}`);
        
        allCategories = await res.json();
        
        if (!Array.isArray(allCategories)) {
            throw new Error('Categories response is not an array');
        }
        
        console.log(`Successfully loaded ${allCategories.length} categories`);
    } catch (err) {
        console.error('Failed to load categories:', err);
        showToast('Failed to load categories.', 'error');
    }
}

function openModal(post = null) {
    const modal = document.getElementById('post-modal');
    const title = document.getElementById('modal-title');
    const form = document.getElementById('post-form');
    
    // Reset form
    form.reset();
    form.postid.value = ''; 
    document.querySelector('.btn-text').textContent = 'Save Post';

    // Categories Checkbox Logic
    const container = document.getElementById('categories-checkboxes');
    const postCategoryNames = post?.categories || []; 

    container.innerHTML = allCategories.map(cat => {
        const isChecked = postCategoryNames.includes(cat.name);
        
        return `
            <label>
                <input type="checkbox" class="category-checkbox" name="categories" value="${cat.category_id}" 
                ${isChecked ? 'checked' : ''}>
                ${cat.name}
            </label>
        `;
    }).join('');
    
    const currentImageUrlInput = document.getElementById('current-image-url');
    const imageFileInput = document.getElementById('image-file-input');
    const previewText = document.getElementById('image-preview-text');

    // Reset file input and preview text
    imageFileInput.value = '';
    previewText.style.display = 'none';
    currentImageUrlInput.value = '';

    // Fill in post data for editing
    if (post) {
        title.textContent = 'Edit Post';
        form.title.value = post.title || '';
        form.content.value = post.content || '';
        form.ispublished.checked = post.ispublished === 1 || post.ispublished === true; 
        form.postid.value = post.postid;

        const imageUrl = post.main_image_url;
        if (imageUrl) {
            currentImageUrlInput.value = imageUrl;
            previewText.textContent = `Current image: ${imageUrl.split('/').pop()}`;
            previewText.style.display = 'block';
        }
    } else {
        title.textContent = 'Add New Post';
    }

    modal.style.display = 'block';
}

function closeModal() {
    document.getElementById('post-modal').style.display = 'none';
}

async function handlePostSubmit(e) {
    e.preventDefault();
    const form = e.target;
    const submitBtn = form.querySelector('button[type="submit"]');
    
    if (!submitBtn) {
        console.error('Submit button not found');
        return;
    }

    const btnText = submitBtn.querySelector('.btn-text');
    const spinner = submitBtn.querySelector('.btn-spinner');

    submitBtn.disabled = true;
    
    if (btnText) btnText.textContent = 'Saving...';
    if (spinner) spinner.style.display = 'inline-block';

    try {
        const formData = new FormData();

        // 1. Gather text and checkbox data
        formData.append('title', form.title.value.trim());
        const contentValue = tinymce.get('post-content-editor') 
    ? tinymce.get('post-content-editor').getContent() 
    : form.content.value.trim();
formData.append('content', contentValue);
        formData.append('is_published', form.ispublished.checked ? 1 : 0);
        
        // 2. Add categories (as IDs)
        const selectedCategories = Array.from(form.querySelectorAll('input[name="categories"]:checked'))
            .map(cb => parseInt(cb.value));
        selectedCategories.forEach(catId => formData.append('categories[]', catId));

        // 3. Handle Image Upload or Existing URL
        const fileInput = document.getElementById('image-file-input');
        const currentImageUrl = document.getElementById('current-image-url');
        
        const imageUrl = currentImageUrl ? currentImageUrl.value : '';

        if (fileInput && fileInput.files.length > 0) {
            formData.append('image_file', fileInput.files[0]);
        } else if (imageUrl) {
            formData.append('main_image_url', imageUrl);
        }
        
        const postId = form.postid.value;
        const url = postId 
            ? `${BASE_API_URL}/posts/${postId}` 
            : `${BASE_API_URL}/posts`;

        if (postId) {
            formData.append('_method', 'PUT');
        }

        const res = await fetch(url, {
            method: 'POST',
            headers: {
                Authorization: `Bearer ${token}`
            },
            body: formData
        });

        const result = await res.json();
        
        if (!res.ok) {
            throw new Error(result.error || 'Failed to save post');
        }

        showToast(`Post ${postId ? 'updated' : 'created'} successfully!`, 'success');
        
        // Reset form
        form.reset();
        
        // Navigate back to posts view
        const navLinks = document.querySelectorAll('.nav-link');
        switchView('posts', navLinks);
        
        // Reload posts
        loadPosts();
    } catch (err) {
        console.error('Error submitting post:', err);
        showToast(`Error: ${err.message}`, 'error');
    } finally {
        submitBtn.disabled = false;
        if (btnText) btnText.textContent = 'Save Post';
        if (spinner) spinner.style.display = 'none';
    }
}

async function editPost(postId) {
    showLoadingSpinner();
    try {
        const res = await fetch(`${BASE_API_URL}/posts/${postId}`, {
            headers: { Authorization: `Bearer ${token}` }
        });
        
        if (!res.ok) {
            const errorData = await res.json();
            throw new Error(errorData.error || 'Failed to fetch post');
        }
        
        const post = await res.json();
        console.log('Editing post:', post);
        
        // Store the post globally before switching view
        currentEditingPost = post;
        
        // Switch to write view
        const navLinks = document.querySelectorAll('.nav-link');
        switchView('write', navLinks);
    } catch (err) {
        console.error('Error editing post:', err);
        showToast(`Error: ${err.message}`, 'error');
    } finally {
        hideLoadingSpinner();
    }
}

async function deletePost(postId) {
    postToDelete = postId;
    
    try {
        const res = await fetch(`${BASE_API_URL}/posts/${postId}`, {
            headers: { Authorization: `Bearer ${token}` }
        });
        
        if (!res.ok) throw new Error('Failed to fetch post');
        
        const post = await res.json();
        
        // Populate modal with post info
        document.getElementById('delete-post-title').textContent = post.title;
        document.getElementById('delete-post-date').textContent = 
            `Created on ${new Date(post.created_at).toLocaleDateString()}`;
        
        // Show modal
        showDeleteModal();
    } catch (err) {
        console.error('Error fetching post:', err);
        showToast('Error loading post details', 'error');
    }
}

function showDeleteModal() {
    const modal = document.getElementById('delete-modal');
    if (modal) {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
}

function hideDeleteModal() {
    const modal = document.getElementById('delete-modal');
    if (modal) {
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
    }
    postToDelete = null;
}

async function loadProfile() {
    try {
        const res = await fetch(`${BASE_API_URL}/blogger`, {
            headers: { Authorization: `Bearer ${token}` }
        });
        
        if (!res.ok) {
            const errorData = await res.json();
            throw new Error(errorData.error || 'Failed to load profile');
        }
        
        const user = await res.json();
        
        // Update profile header
        const displayName = document.getElementById('profile-display-name');
        const displayEmail = document.getElementById('profile-display-email');
        if (displayName) displayName.textContent = user.full_name || 'Blogger';
        if (displayEmail) displayEmail.textContent = user.email || '';
        
        // Fill account form
        const accountForm = document.getElementById('account-form');
        if (accountForm) {
            accountForm.full_name.value = user.full_name || '';
            accountForm.email.value = user.email || '';
            accountForm.username.value = user.username || '';
            accountForm.phone.value = user.phone || '';
            accountForm.bio.value = user.bio || '';
            accountForm.website.value = user.website || '';
            
            // Update char count
            updateBioCharCount();
        }

        // Setup event listeners for account form
        setupAccountFormListeners();
        setupSecurityFormListeners();
        setupPreferencesListeners();
        setupTabListeners();
        setupAvatarUpload();

    } catch (err) {
        console.error('Error loading profile:', err);
        showToast(`Error: ${err.message}`, 'error');
    }
}

function setupTabListeners() {
    const tabButtons = document.querySelectorAll('.profile-tab-btn');
    const tabContents = document.querySelectorAll('.profile-tab-content');
    
    tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const tabName = btn.dataset.tab;
            
            // Update active button
            tabButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Update active content
            tabContents.forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
        });
    });
}

function setupAccountFormListeners() {
    const form = document.getElementById('account-form');
    if (!form) return;

    // Bio character counter
    const bioInput = form.bio;
    if (bioInput) {
        bioInput.addEventListener('input', updateBioCharCount);
    }

    // Form submission
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        
        try {
            const data = {
                full_name: form.full_name.value.trim(),
                email: form.email.value.trim(),
                username: form.username.value.trim(),
                phone: form.phone.value.trim() || null,
                bio: form.bio.value.trim() || null,
                website: form.website.value.trim() || null
            };
            
            const updateRes = await fetch(`${BASE_API_URL}/blogger`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${token}`
                },
                body: JSON.stringify(data)
            });
            
            if (!updateRes.ok) {
                const err = await updateRes.json();
                throw new Error(err.error || 'Update failed');
            }
            
            showToast('Profile updated successfully!', 'success');
            loadProfile(); // Reload profile data
        } catch (err) {
            console.error('Error updating profile:', err);
            showToast(`Error: ${err.message}`, 'error');
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }
    });

    // Reset button
    const resetBtn = document.getElementById('reset-account-btn');
    if (resetBtn) {
        resetBtn.addEventListener('click', () => {
            loadProfile();
        });
    }
}

function setupSecurityFormListeners() {
    const toggleBtn = document.getElementById('toggle-password-form');
    const passwordForm = document.getElementById('password-form');
    const cancelBtn = document.getElementById('cancel-password-btn');

    if (toggleBtn) {
        toggleBtn.addEventListener('click', () => {
            passwordForm.classList.toggle('hidden');
            toggleBtn.textContent = passwordForm.classList.contains('hidden') 
                ? 'Change Password' 
                : 'Hide';
        });
    }

    if (cancelBtn) {
        cancelBtn.addEventListener('click', () => {
            passwordForm.classList.add('hidden');
            if (toggleBtn) toggleBtn.textContent = 'Change Password';
            passwordForm.reset();
        });
    }

    // Password visibility toggles
    document.querySelectorAll('.password-toggle').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = btn.dataset.target;
            const input = document.getElementById(targetId);
            const isPassword = input.type === 'password';
            
            input.type = isPassword ? 'text' : 'password';
            btn.innerHTML = isPassword 
                ? '<i class="fas fa-eye-slash"></i>' 
                : '<i class="fas fa-eye"></i>';
        });
    });

    // Password strength indicator
    const newPasswordInput = document.getElementById('new-password');
    if (newPasswordInput) {
        newPasswordInput.addEventListener('input', updatePasswordStrength);
    }

    // Password form submission
    passwordForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const currentPassword = document.getElementById('current-password').value;
        const newPassword = document.getElementById('new-password').value;
        const confirmPassword = document.getElementById('confirm-password').value;

        if (newPassword !== confirmPassword) {
            showToast('New passwords do not match', 'error');
            return;
        }

        if (newPassword.length < 8) {
            showToast('Password must be at least 8 characters', 'error');
            return;
        }

        const submitBtn = passwordForm.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';

        try {
            const res = await fetch(`${BASE_API_URL}/blogger/change-password`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${token}`
                },
                body: JSON.stringify({
                    current_password: currentPassword,
                    new_password: newPassword
                })
            });

            if (!res.ok) {
                const err = await res.json();
                throw new Error(err.error || 'Password update failed');
            }

            showToast('Password updated successfully!', 'success');
            passwordForm.reset();
            passwordForm.classList.add('hidden');
            document.getElementById('toggle-password-form').textContent = 'Change Password';
        } catch (err) {
            console.error('Error updating password:', err);
            showToast(`Error: ${err.message}`, 'error');
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }
    });

    // 2FA button
    const enable2faBtn = document.getElementById('enable-2fa-btn');
    if (enable2faBtn) {
        enable2faBtn.addEventListener('click', () => {
            showToast('Two-factor authentication is coming soon!', 'info');
        });
    }
}

function setupPreferencesListeners() {
    const preferencesForm = document.getElementById('preferences-form');
    if (!preferencesForm) return;

    preferencesForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const preferences = {
            notify_comments: document.getElementById('notify-comments').checked,
            notify_subscribers: document.getElementById('notify-subscribers').checked,
            notify_weekly: document.getElementById('notify-weekly').checked,
            public_profile: document.getElementById('public-profile').checked,
            show_email: document.getElementById('show-email').checked
        };

        const submitBtn = preferencesForm.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';

        try {
            const res = await fetch(`${BASE_API_URL}/blogger/preferences`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${token}`
                },
                body: JSON.stringify(preferences)
            });

            if (!res.ok) {
                throw new Error('Failed to update preferences');
            }

            showToast('Preferences saved successfully!', 'success');
        } catch (err) {
            console.error('Error updating preferences:', err);
            showToast(`Error: ${err.message}`, 'error');
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }
    });

    // Delete account button
    const deleteBtn = document.getElementById('delete-account-btn');
    if (deleteBtn) {
        deleteBtn.addEventListener('click', () => {
            if (confirm('Are you absolutely sure? This action cannot be undone. All your posts and data will be permanently deleted.')) {
                if (confirm('Type your email to confirm deletion: ' + localStorage.getItem('blogger_email'))) {
                    deleteAccountPermanently();
                }
            }
        });
    }
}

function setupAvatarUpload() {
    const uploadBtn = document.getElementById('avatar-upload-btn');
    const fileInput = document.getElementById('avatar-file-input');
    
    if (uploadBtn) {
        uploadBtn.addEventListener('click', () => fileInput.click());
    }

    if (fileInput) {
        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('avatar', file);

            try {
                const res = await fetch(`${BASE_API_URL}/blogger/avatar`, {
                    method: 'POST',
                    headers: {
                        Authorization: `Bearer ${token}`
                    },
                    body: formData
                });

                if (!res.ok) throw new Error('Failed to upload avatar');

                const data = await res.json();
                document.getElementById('profile-avatar-img').src = data.avatar_url;
                showToast('Avatar updated successfully!', 'success');
            } catch (err) {
                console.error('Error uploading avatar:', err);
                showToast('Failed to upload avatar', 'error');
            }
        });
    }
}

function updateBioCharCount() {
    const bioInput = document.getElementById('profile-bio');
    const charCount = document.getElementById('bio-char-count');
    if (bioInput && charCount) {
        charCount.textContent = bioInput.value.length;
    }
}

function updatePasswordStrength() {
    const password = document.getElementById('new-password').value;
    const indicator = document.getElementById('strength-indicator');
    const text = document.getElementById('strength-text');

    let strength = 'Weak';
    let strengthClass = 'weak';

    if (password.length >= 8) {
        const hasUpper = /[A-Z]/.test(password);
        const hasLower = /[a-z]/.test(password);
        const hasNumber = /[0-9]/.test(password);
        const hasSpecial = /[!@#$%^&*]/.test(password);

        const score = [hasUpper, hasLower, hasNumber, hasSpecial].filter(Boolean).length;

        if (score >= 3) {
            strength = 'Strong';
            strengthClass = 'strong';
        } else if (score >= 2) {
            strength = 'Medium';
            strengthClass = 'medium';
        }
    }

    indicator.className = `strength-indicator ${strengthClass}`;
    text.textContent = `Password strength: ${strength}`;
}

async function deleteAccountPermanently() {
    try {
        const res = await fetch(`${BASE_API_URL}/blogger`, {
            method: 'DELETE',
            headers: {
                Authorization: `Bearer ${token}`
            }
        });

        if (!res.ok) throw new Error('Failed to delete account');

        showToast('Account deleted successfully', 'success');
        setTimeout(() => {
            localStorage.removeItem('auth_token');
            window.location.href = '../auth/signup.html';
        }, 1500);
    } catch (err) {
        console.error('Error deleting account:', err);
        showToast('Failed to delete account', 'error');
    }
}

async function loadBloggerGreeting() {
    try {
        const res = await fetch(`${BASE_API_URL}/blogger`, {
            headers: { Authorization: `Bearer ${token}` }
        });
        
        if (!res.ok) return;
        
        const user = await res.json();
        const nameElement = document.getElementById('blogger-name');
        if (nameElement && user.full_name) {
            nameElement.textContent = user.full_name.split(' ')[0]; // First name only
        }
    } catch (err) {
        console.error('Error loading blogger name:', err);
    }
}


async function loadDashboardStats() {
    try {
        const res = await fetch(`${BASE_API_URL}/posts?blogger_id=${bloggerId}`, {
            headers: { Authorization: `Bearer ${token}` }
        });
        
        if (!res.ok) return;
        
        const posts = await res.json();
        
        if (!Array.isArray(posts)) return;
        
        const totalPosts = posts.length;
        const publishedPosts = posts.filter(p => p.ispublished === 1 || p.ispublished === true).length;
        
        // Update stat elements
        const statsPostsEl = document.getElementById('stat-posts');
        const statsPublishedEl = document.getElementById('stat-published');
        
        if (statsPostsEl) statsPostsEl.textContent = totalPosts;
        if (statsPublishedEl) statsPublishedEl.textContent = publishedPosts;
        
        // Load subscriber count
        loadSubscriberCount();
    } catch (err) {
        console.error('Error loading dashboard stats:', err);
    }
}

async function loadSubscriberCount() {
    try {
        const res = await fetch(`${BASE_API_URL}/subscribers?blogger_id=${bloggerId}`, {
            headers: { Authorization: `Bearer ${token}` }
        });
        
        if (!res.ok) return;
        
        const subscribers = await res.json();
        const count = Array.isArray(subscribers) ? subscribers.length : 0;
        
        const statsSubscribersEl = document.getElementById('stat-subscribers');
        if (statsSubscribersEl) statsSubscribersEl.textContent = count;
    } catch (err) {
        console.log('Note: Subscriber endpoint may not be available yet');
    }
}

-->